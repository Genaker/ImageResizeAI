<?xml version="1.0"?>
<!--
/**
 * Genaker ImageAIBundle
 *
 * @category    Genaker
 * @package     Genaker_ImageAIBundle
 * @author      Genaker
 * @copyright   Copyright (c) 2024 Genaker
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Genaker\ImageAIBundle\Api\ImageResizeServiceInterface" type="Genaker\ImageAIBundle\Service\ImageResizeService"/>
            <type name="Genaker\ImageAIBundle\Service\ImageResizeService">
                <arguments>
                    <argument name="geminiService" xsi:type="object">Genaker\ImageAIBundle\Service\GeminiImageModificationService</argument>
                </arguments>
            </type>
            <type name="Genaker\ImageAIBundle\Service\GeminiVideoService">
                <arguments>
                    <argument name="scopeConfig" xsi:type="object">Magento\Framework\App\Config\ScopeConfigInterface</argument>
                </arguments>
            </type>
            <!-- Default video service: Direct HTTP implementation (no SDK dependency) -->
            <type name="Genaker\ImageAIBundle\Service\GeminiVideoDirectService">
                <arguments>
                    <argument name="httpClient" xsi:type="object">Magento\Framework\HTTP\Client\Curl</argument>
                </arguments>
            </type>
            <!-- Controller uses direct HTTP implementation by default -->
            <type name="Genaker\ImageAIBundle\Controller\Resize\Index">
                <arguments>
                    <argument name="videoService" xsi:type="object">Genaker\ImageAIBundle\Service\GeminiVideoDirectService</argument>
                </arguments>
            </type>
    <type name="Magento\MediaStorage\App\Media">
        <plugin name="genaker_imageaibundle_media_plugin" type="Genaker\ImageAIBundle\Plugin\MediaStorage\App\MediaPlugin" sortOrder="1"/>
    </type>
    <type name="Magento\MediaStorage\Model\File\Storage">
        <plugin name="genaker_imageaibundle_storage_plugin" type="Genaker\ImageAIBundle\Plugin\MediaStorage\Model\File\StoragePlugin" sortOrder="1"/>
    </type>
</config>
