<?xml version="1.0"?>
<!--
/**
 * Genaker ImageAIBundle Dependency Injection Configuration
 *
 * @category    Genaker
 * @package     Genaker_ImageAIBundle
 * @author      Genaker
 * @copyright   Copyright (c) 2024 Genaker
 */
-->
<config xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:noNamespaceSchemaLocation="urn:magento:framework:ObjectManager/etc/config.xsd">
    <preference for="Genaker\ImageAIBundle\Api\ImageResizeServiceInterface" type="Genaker\ImageAIBundle\Service\ImageResizeService"/>
    
    <!-- Gemini Client Factory -->
    <type name="Genaker\ImageAIBundle\Service\GeminiClientFactory">
        <arguments>
            <argument name="scopeConfig" xsi:type="object">Magento\Framework\App\Config\ScopeConfigInterface</argument>
        </arguments>
    </type>
    
    <!-- Gemini Image Modification Service -->
    <type name="Genaker\ImageAIBundle\Service\GeminiImageModificationService">
        <arguments>
            <argument name="client" xsi:type="object">Genaker\ImageAIBundle\Service\GeminiClientFactory</argument>
            <argument name="logger" xsi:type="object">Psr\Log\LoggerInterface</argument>
            <argument name="filesystem" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
        </arguments>
    </type>

    <type name="Genaker\ImageAIBundle\Service\ImageResizeService">
        <arguments>
            <argument name="logger" xsi:type="object">Psr\Log\LoggerInterface</argument>
            <argument name="scopeConfig" xsi:type="object">Magento\Framework\App\Config\ScopeConfigInterface</argument>
            <argument name="filesystem" xsi:type="object">Magento\Framework\Filesystem\Driver\File</argument>
            <argument name="imageFactory" xsi:type="object">Magento\Framework\Image\AdapterFactory</argument>
            <argument name="geminiService" xsi:type="object">Genaker\ImageAIBundle\Service\GeminiImageModificationService</argument>
        </arguments>
    </type>
    
    <!-- Lock Manager Service -->
    <type name="Genaker\ImageAIBundle\Service\LockManager">
        <arguments>
            <argument name="lockManager" xsi:type="object">Magento\Framework\Lock\LockManagerInterface</argument>
            <argument name="scopeConfig" xsi:type="object">Magento\Framework\App\Config\ScopeConfigInterface</argument>
        </arguments>
    </type>

    <type name="Genaker\ImageAIBundle\Controller\Resize\Index">
        <arguments>
            <argument name="imageResizeService" xsi:type="object">Genaker\ImageAIBundle\Service\ImageResizeService</argument>
            <argument name="logger" xsi:type="object">Psr\Log\LoggerInterface</argument>
            <argument name="lockManager" xsi:type="object">Genaker\ImageAIBundle\Service\LockManager</argument>
        </arguments>
    </type>
    
    <type name="Genaker\ImageAIBundle\Controller\Adminhtml\Generate\Index">
        <arguments>
            <argument name="imageResizeService" xsi:type="object">Genaker\ImageAIBundle\Service\ImageResizeService</argument>
            <argument name="urlHelper" xsi:type="object">Genaker\ImageAIBundle\Helper\ImageResizeUrl</argument>
            <argument name="logger" xsi:type="object">Psr\Log\LoggerInterface</argument>
        </arguments>
    </type>
</config>

